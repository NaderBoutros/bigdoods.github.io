
  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  


<!Doctype html>
<html id="docs" class="Support">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Roboto+Mono' type='text/css'>
    <link rel="stylesheet" href="/css/styles.css"/>
    <link rel="stylesheet" href="/css/jquery-ui.min.css">
    <link rel="stylesheet" href="/css/sweetalert.css">
    
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/sweetalert.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <!-- Begin Jekyll SEO tag v2.1.0 -->
<title>CoreOS on libvirt - Kubernetes</title>
<meta property="og:title" content="CoreOS on libvirt" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://localhost:4000/docs/getting-started-guides/libvirt-coreos/" />
<meta property="og:url" content="http://localhost:4000/docs/getting-started-guides/libvirt-coreos/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "WebPage",
"headline": "CoreOS on libvirt",
"description": "Production-Grade Container Orchestration",
"publisher": {"@type": "Organization",
"logo": {"@type": "ImageObject",
"url": "http://localhost:4000/images/favicon.png"}},
"url": "http://localhost:4000/docs/getting-started-guides/libvirt-coreos/"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/">View Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
        </ul>
        <!-- <a href="/docs/" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try IFC</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/hellonode/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple ifc cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/">Documentation</a></h3>
            <p>Learn how to use ifc with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other ifc users and the ifc authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.ifc.io">Blog</a></h3>
            <p>Read the latest news for ifc and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core ifc code base?</h5>
            <a href="https://github.com/ifc/ifc" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/ifcio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/ifc/ifc" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/ifc" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/ifc-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Support</h1>
  <h5>Troubleshooting resources, frequently asked questions, and community support channels.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/" >DOCS HOME</a></li>
      <li><a href="/docs/user-guide/" >GUIDES</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/tasks/" >TASKS</a></li>
      <li><a href="/docs/concepts/" >CONCEPTS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
      <li><a href="/docs/tools/" >TOOLS</a></li>
      <!-- <li><a href="/docs/samples/" >SAMPLES</a></li> -->
      <li><a href="/docs/troubleshooting/" class="YAH">SUPPORT</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
    </div>
  </div>
</section>

<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
        
          
  

    

    
      <a class="item" data-title="Support" href="/docs/troubleshooting/"></a>
    
  

  
    <div class="item" data-title="Troubleshooting">
      <div class="container">
        
  

    

    
      <a class="item" data-title="User Guide" href="/docs/user-guide/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Frequently Asked Questions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="User FAQ" href="/docs/faq/user.md"></a>
    
  

  

    

    
      <a class="item" data-title="Developer FAQ" href="/docs/faq/developer.md"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Contributing to the IFC Docs">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Contributing to the Kubernetes Documentation" href="/editdocs/"></a>
    
  

  

    

    
      <a class="item" data-title="Creating a Documentation Pull Request" href="/docs/contribute/create-pull-request/"></a>
    
  

  

    

    
      <a class="item" data-title="Writing a New Topic" href="/docs/contribute/write-new-topic/"></a>
    
  

  

    

    
      <a class="item" data-title="Staging Your Documentation Changes" href="/docs/contribute/stage-documentation-changes/"></a>
    
  

  

    

    
      <a class="item" data-title="Using Page Templates" href="/docs/contribute/page-templates/"></a>
    
  

  

    

    
      <a class="item" data-title="Reviewing Documentation Issues" href="/docs/contribute/review-issues/"></a>
    
  

  

    

    
      <a class="item" data-title="Documentation Style Guide" href="/docs/contribute/style-guide/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Other Resources">
      <div class="container">
        
  

    

    
      <a class="item" data-title="IFC Issue Tracker on GitHub" href="https://github.com/"></a>
    
  

  

    

    
      <a class="item" data-title="Report a Security Vulnerability" href="/docs/reporting-security-issues/"></a>
    
  

  

    

    
      <a class="item" data-title="IFC Release Notes" href="https://github.com/"></a>
    
  

  

    

    
      <a class="item" data-title="Release Roadmap" href="https://github.com/"></a>
    
  


      </div>
    </div>
  


        
        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/getting-started-guides/libvirt-coreos.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>CoreOS on libvirt</h1>
        

        <ul id="markdown-toc">
  <li><a href="#highlights" id="markdown-toc-highlights">Highlights</a></li>
  <li><a href="#warnings-about-libvirt-coreos-use-case" id="markdown-toc-warnings-about-libvirt-coreos-use-case">Warnings about <code class="highlighter-rouge">libvirt-coreos</code> use case</a></li>
  <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a>    <ul>
      <li><a href="#-depending-on-your-distribution-libvirt-access-may-be-denied-by-default-or-may-require-a-password-at-each-access" id="markdown-toc--depending-on-your-distribution-libvirt-access-may-be-denied-by-default-or-may-require-a-password-at-each-access">¹ Depending on your distribution, libvirt access may be denied by default or may require a password at each access.</a></li>
      <li><a href="#-qemu-will-run-with-a-specific-user-it-must-have-access-to-the-vms-drives" id="markdown-toc--qemu-will-run-with-a-specific-user-it-must-have-access-to-the-vms-drives">² Qemu will run with a specific user. It must have access to the VMs drives</a></li>
    </ul>
  </li>
  <li><a href="#setup" id="markdown-toc-setup">Setup</a>    <ul>
      <li><a href="#automated-setup" id="markdown-toc-automated-setup">Automated setup</a></li>
      <li><a href="#manual-setup" id="markdown-toc-manual-setup">Manual setup</a></li>
    </ul>
  </li>
  <li><a href="#management" id="markdown-toc-management">Management</a></li>
  <li><a href="#interacting-with-your-kubernetes-cluster-with-the-kube--scripts" id="markdown-toc-interacting-with-your-kubernetes-cluster-with-the-kube--scripts">Interacting with your Kubernetes cluster with the <code class="highlighter-rouge">kube-*</code> scripts.</a></li>
  <li><a href="#troubleshooting" id="markdown-toc-troubleshooting">Troubleshooting</a>    <ul>
      <li><a href="#-cannot-find-kubernetes-server-linux-amd64targz" id="markdown-toc--cannot-find-kubernetes-server-linux-amd64targz">!!! Cannot find kubernetes-server-linux-amd64.tar.gz</a></li>
      <li><a href="#cant-find-virsh-in-path-please-fix-and-retry" id="markdown-toc-cant-find-virsh-in-path-please-fix-and-retry">Can’t find virsh in PATH, please fix and retry.</a></li>
      <li><a href="#error-failed-to-connect-socket-to-varrunlibvirtlibvirt-sock-no-such-file-or-directory" id="markdown-toc-error-failed-to-connect-socket-to-varrunlibvirtlibvirt-sock-no-such-file-or-directory">error: Failed to connect socket to ‘/var/run/libvirt/libvirt-sock’: No such file or directory</a></li>
      <li><a href="#error-failed-to-connect-socket-to-varrunlibvirtlibvirt-sock-permission-denied" id="markdown-toc-error-failed-to-connect-socket-to-varrunlibvirtlibvirt-sock-permission-denied">error: Failed to connect socket to ‘/var/run/libvirt/libvirt-sock’: Permission denied</a></li>
      <li><a href="#error-out-of-memory-initializing-network-virsh-net-create" id="markdown-toc-error-out-of-memory-initializing-network-virsh-net-create">error: Out of memory initializing network (virsh net-create…)</a></li>
    </ul>
  </li>
  <li><a href="#support-level" id="markdown-toc-support-level">Support Level</a></li>
</ul>

<h3 id="highlights">Highlights</h3>

<ul>
  <li>Super-fast cluster boot-up (few seconds instead of several minutes for vagrant)</li>
  <li>Reduced disk usage thanks to <a href="https://en.wikibooks.org/wiki/QEMU/Images#Copy_on_write">COW</a></li>
  <li>Reduced memory footprint thanks to <a href="https://www.kernel.org/doc/Documentation/vm/ksm.txt">KSM</a></li>
</ul>

<h3 id="warnings-about-libvirt-coreos-use-case">Warnings about <code class="highlighter-rouge">libvirt-coreos</code> use case</h3>

<p>The primary goal of the <code class="highlighter-rouge">libvirt-coreos</code> cluster provider is to deploy a multi-node Kubernetes cluster on local VMs as fast as possible and to be as light as possible in term of resources used.</p>

<p>In order to achieve that goal, its deployment is very different from the “standard production deployment” method used on other providers. This was done on purpose in order to implement some optimizations made possible by the fact that we know that all VMs will be running on the same physical machine.</p>

<p>The <code class="highlighter-rouge">libvirt-coreos</code> cluster provider doesn’t aim at being production look-alike.</p>

<p>Another difference is that no security is enforced on <code class="highlighter-rouge">libvirt-coreos</code> at all. For example,</p>

<ul>
  <li>Kube API server is reachable via a clear-text connection (no SSL);</li>
  <li>Kube API server requires no credentials;</li>
  <li>etcd access is not protected;</li>
  <li>Kubernetes secrets are not protected as securely as they are on production environments;</li>
  <li>etc.</li>
</ul>

<p>So, a k8s application developer should not validate its interaction with Kubernetes on <code class="highlighter-rouge">libvirt-coreos</code> because he might technically succeed in doing things that are prohibited on a production environment like:</p>

<ul>
  <li>un-authenticated access to Kube API server;</li>
  <li>Access to Kubernetes private data structures inside etcd;</li>
  <li>etc.</li>
</ul>

<p>On the other hand, <code class="highlighter-rouge">libvirt-coreos</code> might be useful for people investigating low level implementation of Kubernetes because debugging techniques like sniffing the network traffic or introspecting the etcd content are easier on <code class="highlighter-rouge">libvirt-coreos</code> than on a production deployment.</p>

<h3 id="prerequisites">Prerequisites</h3>

<ol>
  <li>Install <a href="http://www.thekelleys.org.uk/dnsmasq/doc.html">dnsmasq</a></li>
  <li>Install <a href="http://ebtables.netfilter.org/">ebtables</a></li>
  <li>Install <a href="http://wiki.qemu.org/Main_Page">qemu</a></li>
  <li>Install <a href="http://libvirt.org/">libvirt</a></li>
  <li>Install <a href="http://openssl.org/">openssl</a></li>
  <li>Enable and start the libvirt daemon, e.g.:
    <ul>
      <li><code class="highlighter-rouge">systemctl enable libvirtd &amp;&amp; systemctl start libvirtd</code> # for systemd-based systems</li>
      <li><code class="highlighter-rouge">/etc/init.d/libvirt-bin start</code> # for init.d-based systems</li>
    </ul>
  </li>
  <li><a href="https://libvirt.org/aclpolkit.html">Grant libvirt access to your user¹</a></li>
  <li>Check that your $HOME is accessible to the qemu user²</li>
</ol>

<h4 id="-depending-on-your-distribution-libvirt-access-may-be-denied-by-default-or-may-require-a-password-at-each-access">¹ Depending on your distribution, libvirt access may be denied by default or may require a password at each access.</h4>

<p>You can test it with the following command:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>virsh -c qemu:///system pool-list
</code></pre>
</div>

<p>If you have access error messages, please read https://libvirt.org/acl.html and https://libvirt.org/aclpolkit.html .</p>

<p>In short, if your libvirt has been compiled with Polkit support (ex: Arch, Fedora 21), you can create <code class="highlighter-rouge">/etc/polkit-1/rules.d/50-org.libvirt.unix.manage.rules</code> as follows to grant full access to libvirt to <code class="highlighter-rouge">$USER</code></p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>sudo /bin/sh -c <span class="s2">"cat - &gt; /etc/polkit-1/rules.d/50-org.libvirt.unix.manage.rules"</span> <span class="sh">&lt;&lt; EOF
</span></code></pre>
</div>

<div class="language-conf highlighter-rouge"><pre class="highlight"><code><span class="n">polkit</span>.<span class="n">addRule</span>(<span class="n">function</span>(<span class="n">action</span>, <span class="n">subject</span>) {
        <span class="n">if</span> (<span class="n">action</span>.<span class="n">id</span> == <span class="s2">"org.libvirt.unix.manage"</span> &amp;&amp;
            <span class="n">subject</span>.<span class="n">user</span> == <span class="s2">"$USER"</span>) {
                <span class="n">return</span> <span class="n">polkit</span>.<span class="n">Result</span>.<span class="n">YES</span>;
                <span class="n">polkit</span>.<span class="n">log</span>(<span class="s2">"action="</span> + <span class="n">action</span>);
                <span class="n">polkit</span>.<span class="n">log</span>(<span class="s2">"subject="</span> + <span class="n">subject</span>);
        }
});
<span class="n">EOF</span>
</code></pre>
</div>

<p>If your libvirt has not been compiled with Polkit (ex: Ubuntu 14.04.1 LTS), check the permissions on the libvirt unix socket:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ls -l /var/run/libvirt/libvirt-sock
srwxrwx--- 1 root libvirtd 0 févr. 12 16:03 /var/run/libvirt/libvirt-sock

<span class="gp">$ </span>usermod -a -G libvirtd <span class="nv">$USER</span>
<span class="c"># $USER needs to logout/login to have the new group be taken into account</span>
</code></pre>
</div>

<p>(Replace <code class="highlighter-rouge">$USER</code> with your login name)</p>

<h4 id="-qemu-will-run-with-a-specific-user-it-must-have-access-to-the-vms-drives">² Qemu will run with a specific user. It must have access to the VMs drives</h4>

<p>All the disk drive resources needed by the VM (CoreOS disk image, Kubernetes binaries, cloud-init files, etc.) are put inside <code class="highlighter-rouge">./cluster/libvirt-coreos/libvirt_storage_pool</code>.</p>

<p>As we’re using the <code class="highlighter-rouge">qemu:///system</code> instance of libvirt, qemu will run with a specific <code class="highlighter-rouge">user:group</code> distinct from your user. It is configured in <code class="highlighter-rouge">/etc/libvirt/qemu.conf</code>. That qemu user must have access to that libvirt storage pool.</p>

<p>If your <code class="highlighter-rouge">$HOME</code> is world readable, everything is fine. If your $HOME is private, <code class="highlighter-rouge">cluster/kube-up.sh</code> will fail with an error message like:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>error: Cannot access storage file <span class="s1">'$HOME/.../kubernetes/cluster/libvirt-coreos/libvirt_storage_pool/kubernetes_master.img'</span> <span class="o">(</span>as uid:99, gid:78<span class="o">)</span>: Permission denied
</code></pre>
</div>

<p>In order to fix that issue, you have several possibilities:</p>

<ul>
  <li>set <code class="highlighter-rouge">POOL_PATH</code> inside <code class="highlighter-rouge">cluster/libvirt-coreos/config-default.sh</code> to a directory:
    <ul>
      <li>backed by a filesystem with a lot of free disk space</li>
      <li>writable by your user;</li>
      <li>accessible by the qemu user.</li>
    </ul>
  </li>
  <li>Grant the qemu user access to the storage pool.</li>
</ul>

<p>On Arch:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>setfacl -m g:kvm:--x ~
</code></pre>
</div>

<h3 id="setup">Setup</h3>

<p>By default, the libvirt-coreos setup will create a single Kubernetes master and 3 Kubernetes nodes. Because the VM drives use Copy-on-Write and because of memory ballooning and KSM, there is a lot of resource over-allocation.</p>

<p>There is both an automated way and a manual, customizable way of setting up libvirt Kubernetes clusters on CoreOS.</p>

<h4 id="automated-setup">Automated setup</h4>

<p>There is an automated setup script on https://get.k8s.io that will download the tarball for Kubernetes and spawn a Kubernetes cluster on a local CoreOS instances that the script creates. To run this script, use wget or curl with the KUBERNETES_PROVIDER environment variable set to libvirt-coreos:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="nb">export </span><span class="nv">KUBERNETES_PROVIDER</span><span class="o">=</span>libvirt-coreos; wget -q -O - https://get.k8s.io | bash
</code></pre>
</div>

<p>Here is the curl version of this command:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="nb">export </span><span class="nv">KUBERNETES_PROVIDER</span><span class="o">=</span>libvirt-coreos; curl -sS https://get.k8s.io | bash
</code></pre>
</div>

<p>This script downloads and unpacks the tarball, then spawns a Kubernetes cluster on CoreOS instances with the following characteristics:</p>

<ul>
  <li>Total of 4 KVM/QEMU instances</li>
  <li>1 instance acting as a Kubernetes master node</li>
  <li>3 instances acting as minion nodes</li>
</ul>

<p>If you’d like to run this cluster with customized settings, follow the manual setup instructions.</p>

<h4 id="manual-setup">Manual setup</h4>

<p>To start your local cluster, open a shell and run:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="nb">cd </span>kubernetes

<span class="nb">export </span><span class="nv">KUBERNETES_PROVIDER</span><span class="o">=</span>libvirt-coreos
cluster/kube-up.sh
</code></pre>
</div>

<p>The <code class="highlighter-rouge">KUBERNETES_PROVIDER</code> environment variable tells all of the various cluster management scripts which variant to use.  If you forget to set this, the assumption is you are running on Google Compute Engine.</p>

<p>The <code class="highlighter-rouge">NUM_NODES</code> environment variable may be set to specify the number of nodes to start. If it is not set, the number of nodes defaults to 3.</p>

<p>The <code class="highlighter-rouge">KUBE_PUSH</code> environment variable may be set to specify which Kubernetes binaries must be deployed on the cluster. Its possible values are:</p>

<ul>
  <li><code class="highlighter-rouge">release</code> (default if <code class="highlighter-rouge">KUBE_PUSH</code> is not set) will deploy the binaries of <code class="highlighter-rouge">_output/release-tars/kubernetes-server-….tar.gz</code>. This is built with <code class="highlighter-rouge">make release</code> or <code class="highlighter-rouge">make release-skip-tests</code>.</li>
  <li><code class="highlighter-rouge">local</code> will deploy the binaries of <code class="highlighter-rouge">_output/local/go/bin</code>. These are built with <code class="highlighter-rouge">make</code>.</li>
</ul>

<h3 id="management">Management</h3>

<p>You can check that your machines are there and running with:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>virsh -c qemu:///system list
 Id    Name                           State
----------------------------------------------------
 15    kubernetes_master              running
 16    kubernetes_node-01             running
 17    kubernetes_node-02             running
 18    kubernetes_node-03             running
</code></pre>
</div>

<p>You can check that the Kubernetes cluster is working with:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl get nodes
NAME                LABELS              STATUS
192.168.10.2        &lt;none&gt;              Ready
192.168.10.3        &lt;none&gt;              Ready
192.168.10.4        &lt;none&gt;              Ready
</code></pre>
</div>

<p>The VMs are running <a href="https://coreos.com/">CoreOS</a>.
Your ssh keys have already been pushed to the VM. (It looks for ~/.ssh/id_*.pub)
The user to use to connect to the VM is <code class="highlighter-rouge">core</code>.
The IP to connect to the master is 192.168.10.1.
The IPs to connect to the nodes are 192.168.10.2 and onwards.</p>

<p>Connect to <code class="highlighter-rouge">kubernetes_master</code>:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>ssh core@192.168.10.1
</code></pre>
</div>

<p>Connect to <code class="highlighter-rouge">kubernetes_node-01</code>:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>ssh core@192.168.10.2
</code></pre>
</div>

<h3 id="interacting-with-your-kubernetes-cluster-with-the-kube--scripts">Interacting with your Kubernetes cluster with the <code class="highlighter-rouge">kube-*</code> scripts.</h3>

<p>All of the following commands assume you have set <code class="highlighter-rouge">KUBERNETES_PROVIDER</code> appropriately:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="nb">export </span><span class="nv">KUBERNETES_PROVIDER</span><span class="o">=</span>libvirt-coreos
</code></pre>
</div>

<p>Bring up a libvirt-CoreOS cluster of 5 nodes</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="nv">NUM_NODES</span><span class="o">=</span>5 cluster/kube-up.sh
</code></pre>
</div>

<p>Destroy the libvirt-CoreOS cluster</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>cluster/kube-down.sh
</code></pre>
</div>

<p>Update the libvirt-CoreOS cluster with a new Kubernetes release produced by <code class="highlighter-rouge">make release</code> or <code class="highlighter-rouge">make release-skip-tests</code>:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>cluster/kube-push.sh
</code></pre>
</div>

<p>Update the libvirt-CoreOS cluster with the locally built Kubernetes binaries produced by <code class="highlighter-rouge">make</code>:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="nv">KUBE_PUSH</span><span class="o">=</span><span class="nb">local </span>cluster/kube-push.sh
</code></pre>
</div>

<p>Interact with the cluster</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>kubectl ...
</code></pre>
</div>

<h3 id="troubleshooting">Troubleshooting</h3>

<h4 id="-cannot-find-kubernetes-server-linux-amd64targz">!!! Cannot find kubernetes-server-linux-amd64.tar.gz</h4>

<p>Build the release tarballs:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>make release
</code></pre>
</div>

<h4 id="cant-find-virsh-in-path-please-fix-and-retry">Can’t find virsh in PATH, please fix and retry.</h4>

<p>Install libvirt</p>

<p>On Arch:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>pacman -S qemu libvirt
</code></pre>
</div>

<p>On Ubuntu 14.04:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>aptitude install qemu-system-x86 libvirt-bin
</code></pre>
</div>

<p>On Fedora 21:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>yum install qemu libvirt
</code></pre>
</div>

<h4 id="error-failed-to-connect-socket-to-varrunlibvirtlibvirt-sock-no-such-file-or-directory">error: Failed to connect socket to ‘/var/run/libvirt/libvirt-sock’: No such file or directory</h4>

<p>Start the libvirt daemon</p>

<p>On Arch:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>systemctl start libvirtd virtlogd.socket
</code></pre>
</div>

<p>The <code class="highlighter-rouge">virtlogd.socket</code> is not started with the libvirtd daemon. If you enable the <code class="highlighter-rouge">libvirtd.service</code> it is linked and started automatically on the next boot.</p>

<p>On Ubuntu 14.04:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>service libvirt-bin start
</code></pre>
</div>

<h4 id="error-failed-to-connect-socket-to-varrunlibvirtlibvirt-sock-permission-denied">error: Failed to connect socket to ‘/var/run/libvirt/libvirt-sock’: Permission denied</h4>

<p>Fix libvirt access permission (Remember to adapt <code class="highlighter-rouge">$USER</code>)</p>

<p>On Arch and Fedora 21:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>cat &gt; /etc/polkit-1/rules.d/50-org.libvirt.unix.manage.rules <span class="sh">&lt;&lt;EOF
</span></code></pre>
</div>

<div class="language-conf highlighter-rouge"><pre class="highlight"><code><span class="n">polkit</span>.<span class="n">addRule</span>(<span class="n">function</span>(<span class="n">action</span>, <span class="n">subject</span>) {
        <span class="n">if</span> (<span class="n">action</span>.<span class="n">id</span> == <span class="s2">"org.libvirt.unix.manage"</span> &amp;&amp;
            <span class="n">subject</span>.<span class="n">user</span> == <span class="s2">"$USER"</span>) {
                <span class="n">return</span> <span class="n">polkit</span>.<span class="n">Result</span>.<span class="n">YES</span>;
                <span class="n">polkit</span>.<span class="n">log</span>(<span class="s2">"action="</span> + <span class="n">action</span>);
                <span class="n">polkit</span>.<span class="n">log</span>(<span class="s2">"subject="</span> + <span class="n">subject</span>);
        }
});
<span class="n">EOF</span>
</code></pre>
</div>

<p>On Ubuntu:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>usermod -a -G libvirtd <span class="nv">$USER</span>
</code></pre>
</div>

<h4 id="error-out-of-memory-initializing-network-virsh-net-create">error: Out of memory initializing network (virsh net-create…)</h4>

<p>Ensure libvirtd has been restarted since ebtables was installed.</p>

<h2 id="support-level">Support Level</h2>

<table>
  <thead>
    <tr>
      <th>IaaS Provider</th>
      <th>Config. Mgmt</th>
      <th>OS</th>
      <th>Networking</th>
      <th>Docs</th>
      <th>Conforms</th>
      <th>Support Level</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>libvirt/KVM</td>
      <td>CoreOS</td>
      <td>CoreOS</td>
      <td>libvirt/KVM</td>
      <td><a href="/docs/getting-started-guides/libvirt-coreos">docs</a></td>
      <td> </td>
      <td>Community (<a href="https://github.com/lhuard1A">@lhuard1A</a>)</td>
    </tr>
  </tbody>
</table>

<p>For support level information on all solutions, see the <a href="/docs/getting-started-guides/#table-of-solutions">Table of solutions</a> chart.</p>



        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/getting-started-guides/libvirt-coreos.md?pixel" alt="Analytics" /></a>
        
		<script type="text/javascript">
	        PDRTJS_settings_8345992 = {
		        "id" : "8345992",
		        "unique_id" : "/docs/getting-started-guides/libvirt-coreos/",
		        "title" : "CoreOS on libvirt",
		        "permalink" : "http://kubernetes.github.io/docs/getting-started-guides/libvirt-coreos/"
	        };
	        (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
		</script>
		<a href="" onclick="window.open('https://github.com/kubernetes/kubernetes.github.io/issues/new?title=Issue%20with%20' +
		window.location.pathname)" class="button issue">Create an Issue</a>
		<a href="/editdocs#docs/getting-started-guides/libvirt-coreos.md" class="button issue">Edit this Page</a>
	
	</div>
</section>

<footer>
	<main class="light-text">
		<nav>
			<a href="/docs/hellonode/">Get Started</a>
			<a href="/docs/">Documentation</a>
			<a href="http://www.buildingsmart-tech.org/blogs">Blog</a>
			<a href="/community/">Community</a>
		</nav>
		<div class="social">
			<div>
				<a href="https://twitter.com/buildingSMART" class="twitter"><span>twitter</span></a>
				<a href="https://github.com/BuildingSMART" class="github"><span>Github</span></a>
				<a href="https://buildingsmart-team-slackin.herokuapp.com/" class="slack"><span>Slack</span></a>
			</div>
			<div>
				<a href="http://stackoverflow.com/questions/tagged/ifc" class="stack-overflow"><span>Stack Overflow</span></a>
				<a href="https://buildingsmartapi.mobilize.io/" class="mailing-list"><span>Mailing List</span></a>
				<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
			</div>
			<div>
				<a href="https://www.linkedin.com/groups/3690870" class="linkedIn"><span>LinkedIn</span></a>
			</div>
			<div>
				<span>I wish this page</span>
				<input type="text" id="wishField" name="wishField" placeholder="enter your wish">
			</div>
		</div>
		<div id="miceType" class="center">
			<!-- &copy; 2017 The Kubernetes Authors | Documentation Distributed under <a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/LICENSE" class="light-text">CC BY 4.0</a> -->
		</div>
		<div id="miceType" class="center">
			<!-- Copyright &copy; 2017 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">https://www.linuxfoundation.org/trademark-usage</a> -->
		</div>
	</main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
