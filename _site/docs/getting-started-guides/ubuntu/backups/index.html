
  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  


<!Doctype html>
<html id="docs" class="Support">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Roboto+Mono' type='text/css'>
    <link rel="stylesheet" href="/css/styles.css"/>
    <link rel="stylesheet" href="/css/jquery-ui.min.css">
    <link rel="stylesheet" href="/css/sweetalert.css">
    
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/sweetalert.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <!-- Begin Jekyll SEO tag v2.1.0 -->
<title>Backups - Kubernetes</title>
<meta property="og:title" content="Backups" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://localhost:4000/docs/getting-started-guides/ubuntu/backups/" />
<meta property="og:url" content="http://localhost:4000/docs/getting-started-guides/ubuntu/backups/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "WebPage",
"headline": "Backups",
"description": "Production-Grade Container Orchestration",
"publisher": {"@type": "Organization",
"logo": {"@type": "ImageObject",
"url": "http://localhost:4000/images/favicon.png"}},
"url": "http://localhost:4000/docs/getting-started-guides/ubuntu/backups/"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
        </ul>
        <!-- <a href="/docs/" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/hellonode/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Support</h1>
  <h5>Troubleshooting resources, frequently asked questions, and community support channels.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/" >DOCS HOME</a></li>
      <!-- <li><a href="/docs/user-guide/" >GUIDES</a></li> -->
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <!-- <li><a href="/docs/tasks/" >TASKS</a></li> -->
      <li><a href="/docs/concepts/" >CONCEPTS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
      <li><a href="/docs/tools/" >TOOLS</a></li>
      <!-- <li><a href="/docs/samples/" >SAMPLES</a></li> -->
      <li><a href="/docs/troubleshooting/" class="YAH">SUPPORT</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
    </div>
  </div>
</section>

<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
        
          
  

    

    
      <a class="item" data-title="Support" href="/docs/troubleshooting/"></a>
    
  

  
    <div class="item" data-title="Troubleshooting">
      <div class="container">
        
  

    

    
      <a class="item" data-title="User Guide" href="/docs/user-guide/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Frequently Asked Questions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="User FAQ" href="/docs/faq/user.md"></a>
    
  

  

    

    
      <a class="item" data-title="Developer FAQ" href="/docs/faq/developer.md"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Contributing to the IFC Docs">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Contributing to the Kubernetes Documentation" href="/editdocs/"></a>
    
  

  

    

    
      <a class="item" data-title="Creating a Documentation Pull Request" href="/docs/contribute/create-pull-request/"></a>
    
  

  

    

    
      <a class="item" data-title="Writing a New Topic" href="/docs/contribute/write-new-topic/"></a>
    
  

  

    

    
      <a class="item" data-title="Staging Your Documentation Changes" href="/docs/contribute/stage-documentation-changes/"></a>
    
  

  

    

    
      <a class="item" data-title="Using Page Templates" href="/docs/contribute/page-templates/"></a>
    
  

  

    

    
      <a class="item" data-title="Reviewing Documentation Issues" href="/docs/contribute/review-issues/"></a>
    
  

  

    

    
      <a class="item" data-title="Documentation Style Guide" href="/docs/contribute/style-guide/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Other Resources">
      <div class="container">
        
  

    

    
      <a class="item" data-title="IFC Issue Tracker on GitHub" href="https://github.com/"></a>
    
  

  

    

    
      <a class="item" data-title="Report a Security Vulnerability" href="/docs/reporting-security-issues/"></a>
    
  

  

    

    
      <a class="item" data-title="IFC Release Notes" href="https://github.com/"></a>
    
  

  

    

    
      <a class="item" data-title="Release Roadmap" href="https://github.com/"></a>
    
  


      </div>
    </div>
  


        
        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/getting-started-guides/ubuntu/backups.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>Backups</h1>
        

        
<h2 id="exporting-cluster-data">Exporting cluster data</h2>

<p>Exporting of cluster data is not supported at this time.</p>

<h2 id="restoring-cluster-data">Restoring cluster data</h2>

<p>Importing of cluster data is not supported at this time.</p>

<p>This page shows you how to backup and restore data from the different deployed services in a given cluster.</p>

<ul id="markdown-toc">
  <li><a href="#exporting-cluster-data" id="markdown-toc-exporting-cluster-data">Exporting cluster data</a></li>
  <li><a href="#restoring-cluster-data" id="markdown-toc-restoring-cluster-data">Restoring cluster data</a></li>
  <li><a href="#before-you-begin" id="markdown-toc-before-you-begin">Before you begin</a></li>
  <li><a href="#exporting-etcd-data" id="markdown-toc-exporting-etcd-data">Exporting etcd data</a></li>
  <li><a href="#restoring-etcd-data" id="markdown-toc-restoring-etcd-data">Restoring etcd data</a></li>
  <li><a href="#snapshot-etcd-data" id="markdown-toc-snapshot-etcd-data">Snapshot etcd data</a></li>
  <li><a href="#known-limitations" id="markdown-toc-known-limitations">Known Limitations</a>    <ul>
      <li><a href="#loss-of-pki-warning" id="markdown-toc-loss-of-pki-warning">Loss of PKI warning</a></li>
      <li><a href="#restoring-from-snapshot-on-a-scaled-cluster" id="markdown-toc-restoring-from-snapshot-on-a-scaled-cluster">Restoring from snapshot on a scaled cluster</a></li>
    </ul>
  </li>
</ul>

<h2 id="before-you-begin">Before you begin</h2>

<p>This page assumes you have a working Juju deployed cluster.</p>

<h2 id="exporting-etcd-data">Exporting etcd data</h2>

<p>Migrating etcd is a fairly easy task.</p>

<p>Step 1: Snapshot your existing cluster. This is encapsulated in the <code class="highlighter-rouge">snapshot</code>
action.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>juju run-action etcd/0 snapshot
</code></pre>
</div>

<p>Results:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Action queued with id: b46d5d6f-5625-4320-8cda-b611c6ae580c
</code></pre>
</div>

<p>Step 2: Check the status of the action so you can grab the snapshot and verify
the sum. The copy.cmd result output is a copy/paste command for you to download
the exact snapshot that you just created.</p>

<p>Download the snapshot archive from the unit that created the snapshot and verify
the sha256 sum</p>

<div class="highlighter-rouge"><pre class="highlight"><code>juju show-action-output b46d5d6f-5625-4320-8cda-b611c6ae580c
</code></pre>
</div>

<p>Results:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>results:
  copy:
    cmd: juju scp etcd/0:/home/ubuntu/etcd-snapshots/etcd-snapshot-2016-11-09-02.41.47.tar.gz
      .
  snapshot:
    path: /home/ubuntu/etcd-snapshots/etcd-snapshot-2016-11-09-02.41.47.tar.gz
    sha256: 1dea04627812397c51ee87e313433f3102f617a9cab1d1b79698323f6459953d
    size: 68K
status: completed
</code></pre>
</div>

<p>Copy the snapshot to the local disk and then check the sha256sum.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>juju scp etcd/0:/home/ubuntu/etcd-snapshots/etcd-snapshot-2016-11-09-02.41.47.tar.gz .
sha256sum etcd-snapshot-2016-11-09-02.41.47.tar.gz
</code></pre>
</div>

<p>Step 3: Deploy the new cluster leader, and attach the snapshot:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>juju deploy etcd new-etcd --resource snapshot=./etcd-snapshot-2016-11-09-02.41.47.tar.gz
</code></pre>
</div>

<p>Step 4: Re-Initialize the master with the data from the resource we just attached
in step 3.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>juju run-action new-etcd/0 restore
</code></pre>
</div>

<h2 id="restoring-etcd-data">Restoring etcd data</h2>

<p>Allows the operator to restore the data from a cluster-data snapshot. This
comes with caveats and a very specific path to restore a cluster:</p>

<p>The cluster must be in a state of only having a single member. So it’s best to
deploy a new cluster using the etcd charm, without adding any additional units.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>juju deploy etcd new-etcd
</code></pre>
</div>

<blockquote>
  <p>The above code snippet will deploy a single unit of etcd, as ‘new-etcd’</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code>juju run-action etcd/0 restore target=/mnt/etcd-backups
</code></pre>
</div>

<p>Once the restore action has completed, evaluate the cluster health. If the unit
is healthy, you may resume scaling the application to meet your needs.</p>

<ul>
  <li>
    <p><strong>param</strong> target: destination directory to save the existing data.</p>
  </li>
  <li>
    <p><strong>param</strong> skip-backup: Don’t backup any existing data.</p>
  </li>
</ul>

<h2 id="snapshot-etcd-data">Snapshot etcd data</h2>

<p>Allows the operator to snapshot a running clusters data for use in cloning,
backing up, or migrating Etcd clusters.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>juju run-action etcd/0 snapshot target=/mnt/etcd-backups
</code></pre>
</div>

<ul>
  <li><strong>param</strong> target: destination directory to save the resulting snapshot archive.</li>
</ul>

<h1 id="known-limitations">Known Limitations</h1>

<h4 id="loss-of-pki-warning">Loss of PKI warning</h4>

<p>If you destroy the leader - identified with the <code class="highlighter-rouge">*</code> text next to the unit number in status:
all TLS pki will be lost. No PKI migration occurs outside
of the units requesting and registering the certificates.</p>

<blockquote>
  <p>Important:  Mismanaging this configuration will result in locking yourself
out of the cluster, and can potentially break existing deployments in very
strange ways relating to x509 validation of certificates, which affects both
servers and clients.</p>
</blockquote>

<h4 id="restoring-from-snapshot-on-a-scaled-cluster">Restoring from snapshot on a scaled cluster</h4>

<p>Restoring from a snapshot on a scaled cluster will result in a broken cluster.
Etcd performs clustering during unit turn-up, and state is stored in Etcd itself.
During the snapshot restore phase, a new cluster ID is initialized, and peers
are dropped from the snapshot state to enable snapshot restoration. Please
follow the migration instructions above in the restore action description.</p>



        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/getting-started-guides/ubuntu/backups.md?pixel" alt="Analytics" /></a>
        
		<script type="text/javascript">
	        PDRTJS_settings_8345992 = {
		        "id" : "8345992",
		        "unique_id" : "/docs/getting-started-guides/ubuntu/backups/",
		        "title" : "Backups",
		        "permalink" : "http://kubernetes.github.io/docs/getting-started-guides/ubuntu/backups/"
	        };
	        (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
		</script>
		<a href="" onclick="window.open('https://github.com/kubernetes/kubernetes.github.io/issues/new?title=Issue%20with%20' +
		window.location.pathname)" class="button issue">Create an Issue</a>
		<a href="/editdocs#docs/getting-started-guides/ubuntu/backups.md" class="button issue">Edit this Page</a>
	
	</div>
</section>

<footer>
	<main class="light-text">
		<nav>
			<a href="/docs/hellonode/">Get Started</a>
			<a href="/docs/">Documentation</a>
			<a href="http://www.buildingsmart-tech.org/blogs">Blog</a>
			<a href="/community/">Community</a>
		</nav>
		<div class="social">
			<div>
				<a href="https://twitter.com/buildingSMART" class="twitter"><span>twitter</span></a>
				<a href="https://github.com/BuildingSMART" class="github"><span>Github</span></a>
				<a href="https://buildingsmart-team-slackin.herokuapp.com/" class="slack"><span>Slack</span></a>
			</div>
			<div>
				<a href="http://stackoverflow.com/questions/tagged/ifc" class="stack-overflow"><span>Stack Overflow</span></a>
				<a href="https://buildingsmartapi.mobilize.io/" class="mailing-list"><span>Mailing List</span></a>
				<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
			</div>
			<div>
				<a href="https://www.linkedin.com/groups/3690870" class="linkedIn"><span>LinkedIn</span></a>
			</div>
			<div>
				<span>I wish this page</span>
				<input type="text" id="wishField" name="wishField" placeholder="enter your wish">
			</div>
		</div>
		<div id="miceType" class="center">
			<!-- &copy; 2017 The Kubernetes Authors | Documentation Distributed under <a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/LICENSE" class="light-text">CC BY 4.0</a> -->
		</div>
		<div id="miceType" class="center">
			<!-- Copyright &copy; 2017 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">https://www.linuxfoundation.org/trademark-usage</a> -->
		</div>
	</main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
