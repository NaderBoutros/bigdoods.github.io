
  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  


<!Doctype html>
<html id="docs" class="Support">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Roboto+Mono' type='text/css'>
    <link rel="stylesheet" href="/css/styles.css"/>
    <link rel="stylesheet" href="/css/jquery-ui.min.css">
    <link rel="stylesheet" href="/css/sweetalert.css">
    
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/sweetalert.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <!-- Begin Jekyll SEO tag v2.1.0 -->
<title>Operational Considerations - Kubernetes</title>
<meta property="og:title" content="Operational Considerations" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://localhost:4000/docs/getting-started-guides/ubuntu/operational-considerations/" />
<meta property="og:url" content="http://localhost:4000/docs/getting-started-guides/ubuntu/operational-considerations/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "WebPage",
"headline": "Operational Considerations",
"description": "Production-Grade Container Orchestration",
"publisher": {"@type": "Organization",
"logo": {"@type": "ImageObject",
"url": "http://localhost:4000/images/favicon.png"}},
"url": "http://localhost:4000/docs/getting-started-guides/ubuntu/operational-considerations/"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/">View Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
        </ul>
        <!-- <a href="/docs/" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try IFC</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/hellonode/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple ifc cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/">Documentation</a></h3>
            <p>Learn how to use ifc with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other ifc users and the ifc authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.ifc.io">Blog</a></h3>
            <p>Read the latest news for ifc and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core ifc code base?</h5>
            <a href="https://github.com/ifc/ifc" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/ifcio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/ifc/ifc" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/ifc" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/ifc-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Support</h1>
  <h5>Troubleshooting resources, frequently asked questions, and community support channels.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/" >DOCS HOME</a></li>
      <li><a href="/docs/user-guide/" >GUIDES</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/tasks/" >TASKS</a></li>
      <li><a href="/docs/concepts/" >CONCEPTS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
      <li><a href="/docs/tools/" >TOOLS</a></li>
      <!-- <li><a href="/docs/samples/" >SAMPLES</a></li> -->
      <li><a href="/docs/troubleshooting/" class="YAH">SUPPORT</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
    </div>
  </div>
</section>

<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
        
          
  

    

    
      <a class="item" data-title="Support" href="/docs/troubleshooting/"></a>
    
  

  
    <div class="item" data-title="Troubleshooting">
      <div class="container">
        
  

    

    
      <a class="item" data-title="User Guide" href="/docs/user-guide/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Frequently Asked Questions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="User FAQ" href="/docs/faq/user.md"></a>
    
  

  

    

    
      <a class="item" data-title="Developer FAQ" href="/docs/faq/developer.md"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Contributing to the IFC Docs">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Contributing to the Kubernetes Documentation" href="/editdocs/"></a>
    
  

  

    

    
      <a class="item" data-title="Creating a Documentation Pull Request" href="/docs/contribute/create-pull-request/"></a>
    
  

  

    

    
      <a class="item" data-title="Writing a New Topic" href="/docs/contribute/write-new-topic/"></a>
    
  

  

    

    
      <a class="item" data-title="Staging Your Documentation Changes" href="/docs/contribute/stage-documentation-changes/"></a>
    
  

  

    

    
      <a class="item" data-title="Using Page Templates" href="/docs/contribute/page-templates/"></a>
    
  

  

    

    
      <a class="item" data-title="Reviewing Documentation Issues" href="/docs/contribute/review-issues/"></a>
    
  

  

    

    
      <a class="item" data-title="Documentation Style Guide" href="/docs/contribute/style-guide/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Other Resources">
      <div class="container">
        
  

    

    
      <a class="item" data-title="IFC Issue Tracker on GitHub" href="https://github.com/"></a>
    
  

  

    

    
      <a class="item" data-title="Report a Security Vulnerability" href="/docs/reporting-security-issues/"></a>
    
  

  

    

    
      <a class="item" data-title="IFC Release Notes" href="https://github.com/"></a>
    
  

  

    

    
      <a class="item" data-title="Release Roadmap" href="https://github.com/"></a>
    
  


      </div>
    </div>
  


        
        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/getting-started-guides/ubuntu/operational-considerations.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>Operational Considerations</h1>
        

        
<p>This page gives recommendations and hints for people managing long lived clusters</p>

<ul id="markdown-toc">
  <li><a href="#before-you-begin" id="markdown-toc-before-you-begin">Before you begin</a></li>
  <li><a href="#managing-juju" id="markdown-toc-managing-juju">Managing Juju</a>    <ul>
      <li><a href="#sizing-your-controller-node" id="markdown-toc-sizing-your-controller-node">Sizing your controller node</a></li>
      <li><a href="#sshing-into-the-controller-node" id="markdown-toc-sshing-into-the-controller-node">SSHing into the Controller Node</a></li>
    </ul>
  </li>
  <li><a href="#managing-your-kubernetes-cluster" id="markdown-toc-managing-your-kubernetes-cluster">Managing your Kubernetes cluster</a>    <ul>
      <li><a href="#running-privileged-containers" id="markdown-toc-running-privileged-containers">Running privileged containers</a>        <ul>
          <li><a href="#manually" id="markdown-toc-manually">Manually</a></li>
          <li><a href="#programmatically" id="markdown-toc-programmatically">Programmatically</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="before-you-begin">Before you begin</h2>

<p>This page assumes you understand the basics of Juju and Kubernetes.</p>

<h2 id="managing-juju">Managing Juju</h2>

<h3 id="sizing-your-controller-node">Sizing your controller node</h3>

<p>The Juju Controller:</p>

<ul>
  <li>requires about 2 to 2.5GB RAM to operate.</li>
  <li>uses a MongoDB database as a storage backend for the configuration and state of the cluster. This database can grow significantly, and can also be the biggest consumer of CPU cycles on the instance</li>
  <li>aggregates and stores the log data of all services and units. Therefore, significant storage is needed for long lived models. If your intention is to keep the cluster running, make sure to provision at least 64GB for the logs.</li>
</ul>

<p>To bootstrap a controller with constraints run the following command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>juju bootstrap --contraints "mem=8GB cpu-cores=4 root-disk=128G"
</code></pre>
</div>

<p>Juju will select the cheapest instance type matching your constraints on your target cloud. You can also use the <code class="highlighter-rouge">instance-type</code> constraint in conjunction with <code class="highlighter-rouge">root-disk</code> for strict control. For more information about the constraints available, refer to the <a href="https://jujucharms.com/docs/stable/reference-constraints">official documentation</a></p>

<p>Additional information about logging can be found in the <a href="/docs/getting-started-guides/ubuntu/logging">logging section</a></p>

<h3 id="sshing-into-the-controller-node">SSHing into the Controller Node</h3>

<p>By default, Juju will create a pair of SSH keys that it will use to automate the connection to units. They are stored on the client node in <code class="highlighter-rouge">~/.local/share/juju/ssh/</code></p>

<p>After deployment, Juju Controller is a “silent unit” that acts as a proxy between the client and the deployed applications. Nevertheless it can be useful to SSH into it.</p>

<p>First you need to understand your environment, especially if you run several Juju models and controllers. Run</p>

<div class="highlighter-rouge"><pre class="highlight"><code>juju list-models --all
$ juju models --all
Controller: k8s

Model             Cloud/Region   Status     Machines  Cores  Access  Last connection
admin/controller  lxd/localhost  available         1      -  admin   just now
admin/default     lxd/localhost  available         0      -  admin   2017-01-23
admin/whale*      lxd/localhost  available         6      -  admin   3 minutes ago

</code></pre>
</div>

<p>The first line <code class="highlighter-rouge">Controller: k8s</code> refers to how you bootstrapped.</p>

<p>Then you will see 2, 3 or more models listed below.</p>

<ul>
  <li>admin/controller is the default model that hosts all controller units of juju</li>
  <li>admin/default is created by default as the primary model to host the user application, such as the Kubernetes cluster</li>
  <li>admin/whale is an additional model created if you use conjure-up as an overlay on top of Juju.</li>
</ul>

<p>Now to ssh into a controller node, you first ask Juju to switch context, then ssh as you would with a normal unit:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>juju switch controller
</code></pre>
</div>

<p>At this stage, you can query the controller model as well:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>juju status
Model       Controller  Cloud/Region   Version
controller  k8s		   lxd/localhost  2.0.2

App  Version  Status  Scale  Charm  Store  Rev  OS  Notes

Unit  Workload  Agent  Machine  Public address  Ports  Message

Machine  State    DNS           Inst id        Series  AZ
0        started  10.191.22.15  juju-2a5ed8-0  xenial  
</code></pre>
</div>

<p>Note that if you had bootstrapped in HA mode, you would see several machines listed.</p>

<p>Now ssh-ing into the controller follows the same semantic as classic Juju commands:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ juju ssh 0
Welcome to Ubuntu 16.04.1 LTS (GNU/Linux 4.8.0-34-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  Get cloud support with Ubuntu Advantage Cloud Guest:
    http://www.ubuntu.com/business/services/cloud

0 packages can be updated.
0 updates are security updates.


Last login: Tue Jan 24 16:38:13 2017 from 10.191.22.1
ubuntu@juju-2a5ed8-0:~$ 
</code></pre>
</div>

<p>When you are done and want to come back to your initial model, exit the controller and</p>

<p>Then if you need to switch back to your cluster and ssh into the units, run</p>

<div class="highlighter-rouge"><pre class="highlight"><code>juju switch default
</code></pre>
</div>

<h2 id="managing-your-kubernetes-cluster">Managing your Kubernetes cluster</h2>

<h3 id="running-privileged-containers">Running privileged containers</h3>

<p>By default juju-deployed clusters do not support running privileged containers. If you need them, you have to edit <code class="highlighter-rouge">/etc/default/kube-apiserver</code> on the master nodes, and <code class="highlighter-rouge">/etc/default/kubelet</code> on your worker nodes.</p>

<p>On Kubernetes Core or on small deployment, run the following commands from the Juju client:</p>

<h4 id="manually">Manually</h4>

<ol>
  <li>Update the Master</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>juju ssh kubernetes-master/0 "sudo sed -i 's/KUBE_API_ARGS=\"/KUBE_API_ARGS=\"--allow-privileged\ /' /etc/default/kube-apiserver &amp;&amp; sudo systemctl restart kube-apiserver.service"
</code></pre>
</div>

<ol>
  <li>Update the Worker(s)</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>juju ssh kubernetes-worker/0 "sudo sed -i 's/KUBELET_ARGS=\"/KUBELET_ARGS=\"--allow-privileged\ /' /etc/default/kubelet &amp;&amp; sudo systemctl restart kubelet.service"
</code></pre>
</div>

<h4 id="programmatically">Programmatically</h4>

<p>If the deployment is larger the following commands will run on all units successively:</p>

<ol>
  <li>Update all Masters</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>juju show-status kubernetes-master --format json | \
	jq --raw-output '.applications."kubernetes-master".units | keys[]' | \
	xargs -I UNIT juju ssh UNIT "sudo sed -i 's/KUBE_API_ARGS=\"/KUBE_API_ARGS=\"--allow-privileged\ /' /etc/default/kube-apiserver &amp;&amp; sudo systemctl restart kube-apiserver.service"
</code></pre>
</div>

<ol>
  <li>Update all workers</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>juju show-status kubernetes-worker --format json | \
	jq --raw-output '.applications."kubernetes-worker".units | keys[]' | \
	xargs -I UNIT juju ssh UNIT "sudo sed -i 's/KUBELET_ARGS=\"/KUBELET_ARGS=\"--allow-privileged\ /' /etc/default/kubelet &amp;&amp; sudo systemctl restart kubelet.service"
</code></pre>
</div>



        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/getting-started-guides/ubuntu/operational-considerations.md?pixel" alt="Analytics" /></a>
        
		<!-- <script type="text/javascript">
	        PDRTJS_settings_8345992 = {
		        "id" : "8345992",
		        "unique_id" : "/docs/getting-started-guides/ubuntu/operational-considerations/",
		        "title" : "Operational Considerations",
		        "permalink" : "http://kubernetes.github.io/docs/getting-started-guides/ubuntu/operational-considerations/"
	        };
	        (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
		</script> -->

  <!-- Need to attach listener to the 'make an issue' button below -->

		<a href="" onclick="window.open('https://github.com/bigdoods/bigdoods.github.io/issues/new?title=Issue%20with%20' +
		window.location.pathname)" class="button issue">Create an Issue</a>
		<a href="/editdocs#docs/getting-started-guides/ubuntu/operational-considerations.md" class="button issue">Edit this Page</a>
	
	</div>
</section>

<footer>
	<main class="light-text">
		<nav>
			<a href="/docs/hellonode/">Get Started</a>
			<a href="/docs/">Documentation</a>
			<a href="http://www.buildingsmart-tech.org/blogs">Blog</a>
			<a href="/community/">Community</a>
		</nav>
		<div class="social">
			<div>
				<a href="https://twitter.com/buildingSMART" class="twitter"><span>twitter</span></a>
				<a href="https://github.com/BuildingSMART" class="github"><span>Github</span></a>
				<a href="https://buildingsmart-team-slackin.herokuapp.com/" class="slack"><span>Slack</span></a>
			</div>
			<div>
				<a href="http://stackoverflow.com/questions/tagged/ifc" class="stack-overflow"><span>Stack Overflow</span></a>
				<a href="https://buildingsmartapi.mobilize.io/" class="mailing-list"><span>Mailing List</span></a>
				<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
			</div>
			<div>
				<a href="https://www.linkedin.com/groups/3690870" class="linkedIn"><span>LinkedIn</span></a>
			</div>
			<div>
				<span>I wish this page</span>
				<input type="text" id="wishField" name="wishField" placeholder="enter your wish">
			</div>
		</div>
		<div id="miceType" class="center">
			<!-- &copy; 2017 The Kubernetes Authors | Documentation Distributed under <a href="https://github.com/bigdoods/bigdoods.github.io/blob/master/LICENSE" class="light-text">CC BY 4.0</a> -->
		</div>
		<div id="miceType" class="center">
			&copy; 2017 Buildingsmart
			<!-- Copyright &copy; 2017 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">https://www.linuxfoundation.org/trademark-usage</a> -->
		</div>
	</main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
