
  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  


<!Doctype html>
<html id="docs" class="Support">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Roboto+Mono' type='text/css'>
    <link rel="stylesheet" href="/css/styles.css"/>
    <link rel="stylesheet" href="/css/jquery-ui.min.css">
    <link rel="stylesheet" href="/css/sweetalert.css">
    
    <script src="/js/jquery-2.2.0.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/sweetalert.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <!-- Begin Jekyll SEO tag v2.1.0 -->
<title>Example Walkthrough - Kubernetes</title>
<meta property="og:title" content="Example Walkthrough" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://localhost:4000/docs/getting-started-guides/network-policy/walkthrough/" />
<meta property="og:url" content="http://localhost:4000/docs/getting-started-guides/network-policy/walkthrough/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kubernetesio" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "WebPage",
"headline": "Example Walkthrough",
"description": "Production-Grade Container Orchestration",
"publisher": {"@type": "Organization",
"logo": {"@type": "ImageObject",
"url": "http://localhost:4000/images/favicon.png"}},
"url": "http://localhost:4000/docs/getting-started-guides/network-policy/walkthrough/"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
        </ul>
        <!-- <a href="/docs/" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/hellonode/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Support</h1>
  <h5>Troubleshooting resources, frequently asked questions, and community support channels.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/" >DOCS HOME</a></li>
      <li><a href="/docs/user-guide/" >GUIDES</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/tasks/" >TASKS</a></li>
      <li><a href="/docs/concepts/" >CONCEPTS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
      <li><a href="/docs/tools/" >TOOLS</a></li>
      <li><a href="/docs/samples/" >SAMPLES</a></li>
      <li><a href="/docs/troubleshooting/" class="YAH">SUPPORT</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
    </div>
  </div>
</section>

<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
        
          
  

    

    
      <a class="item" data-title="Support" href="/docs/troubleshooting/"></a>
    
  

  
    <div class="item" data-title="Troubleshooting">
      <div class="container">
        
  

    

    
      <a class="item" data-title="User Guide" href="/docs/user-guide/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Frequently Asked Questions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="User FAQ" href="https://github.com/kubernetes/kubernetes/wiki/User-FAQ/"></a>
    
  

  

    

    
      <a class="item" data-title="Debugging FAQ" href="https://github.com/kubernetes/kubernetes/wiki/Debugging-FAQ/"></a>
    
  

  

    

    
      <a class="item" data-title="Services FAQ" href="https://github.com/kubernetes/kubernetes/wiki/Services-FAQ/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Contributing to the Kubernetes Docs">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Contributing to the Kubernetes Documentation" href="/editdocs/"></a>
    
  

  

    

    
      <a class="item" data-title="Creating a Documentation Pull Request" href="/docs/contribute/create-pull-request/"></a>
    
  

  

    

    
      <a class="item" data-title="Writing a New Topic" href="/docs/contribute/write-new-topic/"></a>
    
  

  

    

    
      <a class="item" data-title="Staging Your Documentation Changes" href="/docs/contribute/stage-documentation-changes/"></a>
    
  

  

    

    
      <a class="item" data-title="Using Page Templates" href="/docs/contribute/page-templates/"></a>
    
  

  

    

    
      <a class="item" data-title="Reviewing Documentation Issues" href="/docs/contribute/review-issues/"></a>
    
  

  

    

    
      <a class="item" data-title="Documentation Style Guide" href="/docs/contribute/style-guide/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Other Resources">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Kubernetes Issue Tracker on GitHub" href="https://github.com/kubernetes/kubernetes/issues/"></a>
    
  

  

    

    
      <a class="item" data-title="Report a Security Vulnerability" href="/docs/reporting-security-issues/"></a>
    
  

  

    

    
      <a class="item" data-title="Release Notes" href="https://github.com/kubernetes/kubernetes/releases/"></a>
    
  

  

    

    
      <a class="item" data-title="Release Roadmap" href="https://github.com/kubernetes/kubernetes/milestones/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Deprecation Policy" href="/docs/deprecation-policy.md"></a>
    
  


        
        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/getting-started-guides/network-policy/walkthrough.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>Example Walkthrough</h1>
        

        <p>Kubernetes can be used to declare network policies which govern how Pods can communicate with each other.  This document helps you get started using the Kubernetes <a href="/docs/user-guide/networkpolicies">NetworkPolicy API</a>, and provides a demonstration thereof.</p>

<p>In this article, we assume a Kubernetes cluster has been created with network policy support. There are a number of network providers that support NetworkPolicy including:</p>

<ul>
  <li><a href="/docs/getting-started-guides/network-policy/calico/">Calico</a></li>
  <li><a href="/docs/getting-started-guides/network-policy/romana/">Romana</a></li>
  <li><a href="/docs/getting-started-guides/network-policy/weave/">Weave Net</a></li>
</ul>

<p>Add-ons are sorted alphabetically - the ordering does not imply any preferential status.</p>

<p>The following example walkthrough will work on a Kubernetes cluster using any of the listed providers.</p>

<h2 id="using-networkpolicy">Using NetworkPolicy</h2>

<p>To explain how Kubernetes network policy works let’s start off by creating an <code class="highlighter-rouge">nginx</code> Deployment and expose it via a Service.</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">kubectl</span><span class="kv"> run nginx --image=nginx --replicas=2
</span>deployment "nginx" created
<span class="w">$ </span><span class="nc">kubectl</span><span class="kv"> expose deployment nginx --port=80 
</span>service "nginx" exposed
</code></pre>
</div>

<p>This will run two nginx Pods in the default Namespace, and expose them through a Service called <code class="highlighter-rouge">nginx</code>.</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">kubectl</span><span class="kv"> get svc,pod
</span>NAME                    CLUSTER-IP    EXTERNAL-IP   PORT(S)    AGE
kubernetes              10.100.0.1    &lt;none&gt;        443/TCP    46m
nginx                   10.100.0.16   &lt;none&gt;        80/TCP     33s
NAME                    READY         STATUS        RESTARTS   AGE
nginx-701339712-e0qfq   1/1           Running       0          35s
nginx-701339712-o00ef   1/1           Running       0          35s
</code></pre>
</div>

<p>We should be able to access our new nginx Service from other Pods.  Let’s try to access it from another Pod 
in the default namespace.  We haven’t put any network policy in place, so this should just work. Start a 
busybox container, and use <code class="highlighter-rouge">wget</code> to hit the nginx Service:</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">kubectl</span><span class="kv"> run busybox --rm -ti --image=busybox /bin/sh
</span>Waiting for pod default/busybox-472357175-y0m47 to be running, status is Pending, pod ready: false

Hit enter for command prompt

/ # wget -s --timeout=1 nginx
Connecting to nginx (10.100.0.16:80)
/ #
</code></pre>
</div>

<p>Let’s say we want to limit access to our nginx Service so that only pods with the label <code class="highlighter-rouge">access: true</code> can query it.  First, we’ll
enable ingress isolation on the <code class="highlighter-rouge">default</code> Namespace.  This will prevent <em>any</em> pods from accessing the nginx Service.</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">kubectl</span><span class="kv"> annotate ns default "net.beta.kubernetes.io/network-policy={\"ingress\": {\"isolation\": \"DefaultDeny\"}}"
</span></code></pre>
</div>

<p>With ingress isolation in place, we should no longer be able to access the nginx Service like we were able to before.</p>

<p>Let’s now create a <code class="highlighter-rouge">NetworkPolicy</code> which allows connections from pods with the label <code class="highlighter-rouge">access: true</code>.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">kind</span><span class="pi">:</span> <span class="s">NetworkPolicy</span>
<span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">access-nginx</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">podSelector</span><span class="pi">:</span>
    <span class="s">matchLabels</span><span class="pi">:</span>
      <span class="s">run</span><span class="pi">:</span> <span class="s">nginx</span>
  <span class="s">ingress</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">from</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">podSelector</span><span class="pi">:</span>
          <span class="s">matchLabels</span><span class="pi">:</span>
            <span class="s">access</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
</code></pre>
</div>

<p>Use kubectl to create the above nginx-policy.yaml file:</p>
<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">kubectl</span><span class="kv"> create -f nginx-policy.yaml
</span>networkpolicy "access-nginx" created
</code></pre>
</div>

<p>If we attempt to access the nginx Service from a pod without the correct labels, the request will timeout:</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">kubectl</span><span class="kv"> run busybox --rm -ti --image=busybox /bin/sh
</span>Waiting for pod default/busybox-472357175-y0m47 to be running, status is Pending, pod ready: false

Hit enter for command prompt

/ # wget -s --timeout=1 nginx 
Connecting to nginx (10.100.0.16:80)
wget: download timed out
/ #
</code></pre>
</div>

<p>However, if we create a Pod with the correct labels, the request will be allowed:</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">kubectl</span><span class="kv"> run busybox --rm -ti --labels="access=true" --image=busybox /bin/sh
</span>Waiting for pod default/busybox-472357175-y0m47 to be running, status is Pending, pod ready: false

Hit enter for command prompt

/ # wget -s --timeout=1 nginx
Connecting to nginx (10.100.0.16:80)
/ #
</code></pre>
</div>


        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/getting-started-guides/network-policy/walkthrough.md?pixel" alt="Analytics" /></a>
        
		<script type="text/javascript">
	        PDRTJS_settings_8345992 = {
		        "id" : "8345992",
		        "unique_id" : "/docs/getting-started-guides/network-policy/walkthrough/",
		        "title" : "Example Walkthrough",
		        "permalink" : "http://kubernetes.github.io/docs/getting-started-guides/network-policy/walkthrough/"
	        };
	        (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
		</script>
		<a href="" onclick="window.open('https://github.com/kubernetes/kubernetes.github.io/issues/new?title=Issue%20with%20' +
		window.location.pathname)" class="button issue">Create an Issue</a>
		<a href="/editdocs#docs/getting-started-guides/network-policy/walkthrough.md" class="button issue">Edit this Page</a>
	
	</div>
</section>

<footer>
	<main class="light-text">
		<nav>
			<a href="/docs/hellonode/">Get Started</a>
			<a href="/docs/">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/partners/">Partners</a>
			<a href="/community/">Community</a>
			<a href="/case-studies/">Case Studies</a>
		</nav>
		<div class="social">
			<div>
				<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
				<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
				<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			</div>
			<div>
				<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
				<a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
				<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
			</div>
			<div>
				<a href="//get.k8s.io" class="button">Download K8s</a>
				<a href="https://github.com/kubernetes/kubernetes" class="button">Contribute to the K8s codebase</a>
			</div>
		</div>
		<div id="miceType" class="center">
			&copy; 2017 The Kubernetes Authors | Documentation Distributed under <a href="https://github.com/kubernetes/kubernetes.github.io/blob/master/LICENSE" class="light-text">CC BY 4.0</a>
		</div>
		<div id="miceType" class="center">
			Copyright &copy; 2017 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">https://www.linuxfoundation.org/trademark-usage</a>
		</div>
	</main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
